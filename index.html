<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Transporte Escolar</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2b7cff">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<h2>Login</h2>
<input id="email" placeholder="Email">
<input id="password" type="password">
<button onclick="login()">Ingresar</button>

<hr>

<!-- SELECCIÓN DE MODO -->
<div id="modo" style="display:none">
  <h3>¿Cómo deseas ingresar?</h3>
  <button onclick="modoPadre()">Padre</button>
  <button onclick="modoTransportista()">Transportista</button>
</div>

<!-- PADRE -->
<div id="padre" style="display:none">
  <h3>Panel Padre</h3>

  <input id="nombreHijo" placeholder="Nombre del hijo"><br><br>
  <input id="entrada" type="time">
  <input id="salida" type="time"><br><br>

  <button onclick="guardarHijo()">Agregar hijo</button>

  <h4>Mis hijos</h4>
  <ul id="listaPadre"></ul>
</div>

<!-- TRANSPORTISTA -->
<div id="transportista" style="display:none">
  <h3>Panel Transportista</h3>
  <ul id="listaHorarios"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  addDoc,
  collection,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyA9DvyiDMZnncv3wUPCaDrzuUHcAV0UKCw",
  authDomain: "app-transporte-25487.firebaseapp.com",
  projectId: "app-transporte-25487",
  storageBucket: "app-transporte-25487.firebasestorage.app",
  messagingSenderId: "818710436467",
  appId: "1:818710436467:web:06fc21171780afca7a6806"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let usuario;

/* LOGIN */
window.login = async () => {
  const cred = await signInWithEmailAndPassword(
    auth,
    email.value,
    password.value
  );

  usuario = cred.user;
  modo.style.display = "block";
};

/* MODO */
window.modoPadre = () => {
  modo.style.display = "none";
  padre.style.display = "block";
  cargarHijosPadre();
};

window.modoTransportista = () => {
  modo.style.display = "none";
  transportista.style.display = "block";
  cargarHorariosTransportista();
};

/* PADRE */
window.guardarHijo = async () => {
  await addDoc(
    collection(db, "horarios"),
    {
      nombre: nombreHijo.value,
      entrada: entrada.value,
      salida: salida.value,
      createdAt: new Date()
    }
  );

  nombreHijo.value = "";
  entrada.value = "";
  salida.value = "";

  cargarHijosPadre();
};

async function cargarHijosPadre() {
  listaPadre.innerHTML = "";
  const snap = await getDocs(collection(db, "horarios"));

  snap.forEach(doc => {
    const d = doc.data();
    listaPadre.innerHTML += `
      <li>
        <b>${d.nombre}</b><br>
        ${d.entrada} - ${d.salida}
      </li>
    `;
  });
}

/* TRANSPORTISTA */
async function cargarHorariosTransportista() {
  listaHorarios.innerHTML = "";
  const snap = await getDocs(collection(db, "horarios"));

  snap.forEach(doc => {
    const d = doc.data();
    listaHorarios.innerHTML += `
      <li>
        <b>${d.nombre}</b><br>
        Entrada: ${d.entrada}<br>
        Salida: ${d.salida}
      </li>
    `;
  });
}
</script>

</body>
</html>
